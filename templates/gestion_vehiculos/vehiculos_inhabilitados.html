{% extends 'base.html' %}
{% load static %}

{% block title %}Vehiculos Inhabilitados | NaviPort RD{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/styles.css' %}">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="navbar">
    <div class="navbar-brand">
        <div class="logo">NP</div>
        NaviPort RD
    </div>
    <ul class="navbar-menu">
        {% if user.role == 'solicitante' %}
            <li><a href="{% url 'solicitudes:dashboard' %}" style="color: inherit; text-decoration: none;">Dashboard</a></li>
            <li><a href="{% url 'solicitudes:mis_solicitudes' %}" style="color: inherit; text-decoration: none;">Solicitudes</a></li>
            <li><a href="{% url 'gestion_personal:dashboard' %}" style="color: inherit; text-decoration: none;">Personal</a></li>
            <li class="active">Vehiculos</li>
            <li><a href="{% url 'solicitudes:mis_autorizaciones' %}" style="color: inherit; text-decoration: none;">Autorizaciones</a></li>
        {% else %}
            <li><a href="{% url 'gestion_personal:dashboard' %}" style="color: inherit; text-decoration: none;">Personal</a></li>
            <li class="active">Vehiculos</li>
        {% endif %}
    </ul>
    <div class="navbar-user">
        <div style="text-align: right; margin-right: 10px;">
            <div class="user-name">{{ user.get_display_name }}</div>
            <div style="font-size: 14px; color: #7f8c8d;">{{ user.get_role_display_with_admin }}</div>
        </div>
        <div class="user-avatar">{{ user.get_display_name|slice:':1'|upper }}{{ user.last_name|slice:':1'|upper }}</div>
        <div class="user-dropdown">
            <a href="{% url 'accounts:logout' %}" class="logout-link">Salir</a>
        </div>
    </div>
</div>

<div class="content-area">
    <div class="page-header">
        <div>
            <h2 style="color: #2c3e50; margin-bottom: 10px;">Vehiculos Inhabilitados</h2>
            <p style="color: #7f8c8d;">Vehiculos marcados como inactivos que pueden ser reactivados</p>
        </div>
        <div>
            <a href="{% url 'gestion_vehiculos:dashboard' %}" class="btn btn-primary">
                Volver a Vehiculos Activos
            </a>
        </div>
    </div>

    <!-- Estadisticas -->
    <div class="row mb-4">
        <div class="col-md-4">
            <div class="card bg-warning text-dark">
                <div class="card-body text-center">
                    <h3 class="mb-0">{{ total_inhabilitados }}</h3>
                    <p class="mb-0">Vehiculos Inhabilitados</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Busqueda -->
    <div class="search-container mb-4">
        <form method="get" class="d-flex gap-2">
            <input type="text" name="q" class="form-control" placeholder="Buscar por placa, marca, modelo o motivo..." value="{{ query }}">
            <button type="submit" class="btn btn-primary">Buscar</button>
            {% if query %}
            <a href="{% url 'gestion_vehiculos:vehiculos_inhabilitados' %}" class="btn btn-outline-secondary">Limpiar</a>
            {% endif %}
        </form>
    </div>

    <!-- Tabla de vehiculos inhabilitados -->
    <div class="table-container">
        <div class="table-responsive">
            <table class="table table-striped table-hover table-bordered">
                <thead style="background: #6c757d; color: white;">
                    <tr>
                        <th>Placa</th>
                        <th>Marca / Modelo</th>
                        <th>Ano</th>
                        <th>Color</th>
                        <th>Motivo de Inhabilitacion</th>
                        <th>Fecha Inhabilitacion</th>
                        <th>Inhabilitado Por</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    {% for vehiculo in vehiculos %}
                    <tr>
                        <td>
                            <strong>{{ vehiculo.placa }}</strong>
                            <br>
                            <span class="badge bg-secondary">{{ vehiculo.get_tipo_vehiculo_display }}</span>
                        </td>
                        <td>{{ vehiculo.marca }} {{ vehiculo.modelo }}</td>
                        <td>{{ vehiculo.ano }}</td>
                        <td>{{ vehiculo.color }}</td>
                        <td>
                            <small class="text-muted">
                                {{ vehiculo.motivo_inhabilitacion|default:"Sin motivo registrado"|truncatewords:15 }}
                            </small>
                        </td>
                        <td>
                            {% if vehiculo.fecha_inhabilitacion %}
                                {{ vehiculo.fecha_inhabilitacion|date:"d/m/Y H:i" }}
                            {% else %}
                                <span class="text-muted">-</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if vehiculo.inhabilitado_por %}
                                {{ vehiculo.inhabilitado_por.first_name }} {{ vehiculo.inhabilitado_por.last_name }}
                            {% else %}
                                <span class="text-muted">-</span>
                            {% endif %}
                        </td>
                        <td>
                            <div class="d-flex gap-1">
                                <a href="{% url 'gestion_vehiculos:reactivar_vehiculo' vehiculo.id %}"
                                   class="btn btn-sm btn-success" title="Reactivar vehiculo">
                                    Reactivar
                                </a>
                            </div>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="8" class="text-center" style="padding: 40px;">
                            <div style="color: #7f8c8d;">
                                <div style="font-size: 48px; margin-bottom: 15px;">&#9989;</div>
                                <h4>No hay vehiculos inhabilitados</h4>
                                <p>Todos los vehiculos estan activos.</p>
                                <a href="{% url 'gestion_vehiculos:dashboard' %}" class="btn btn-primary">
                                    Ver Vehiculos Activos
                                </a>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
{% endblock %}
