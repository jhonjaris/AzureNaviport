{% extends 'base.html' %}
{% load static %}

{% block title %}{{ empresa.nombre }} | NaviPort RD{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'empresas/css/empresas.css' %}">
{% endblock %}

{% block content %}
<div class="navbar">
    <div class="navbar-brand">
        <div class="logo">NP</div>
        NaviPort RD
    </div>
    <ul class="navbar-menu">
        <li><a href="{% url 'evaluacion:dashboard' %}" style="color: inherit; text-decoration: none;">Dashboard</a></li>
        <li>Evaluaciones</li>
        <li>Reportes</li>
        <li class="active">Detalle de Empresa</li>
        <li>Configuraci√≥n</li>
    </ul>
    <div class="navbar-user">
        <div style="text-align: right; margin-right: 10px;">
            <div style="font-weight: 500;">{{ user.get_display_name }}</div>
            <div style="font-size: 14px; color: #7f8c8d;">{{ user.get_role_display_with_admin }}</div>
        </div>
        <div class="user-avatar">{{ user.get_display_name|slice:':1'|upper }}{{ user.last_name|slice:':1'|upper }}</div>
        <div class="user-dropdown">
            <a href="{% url 'accounts:logout' %}" class="logout-link">üö™ Salir</a>
        </div>
    </div>
</div>

<div class="content-area">
    <div style="margin-bottom: 30px;">
        <h2 style="color: #2c3e50; margin-bottom: 10px;">
            üè¢ {{ empresa.nombre }}
            {% if not empresa.activa %}
                <span class="status-badge status-rejected" style="font-size: 14px;">Inactiva</span>
            {% elif not empresa.licencia_vigente %}
                <span class="status-badge" style="background: #e74c3c; font-size: 14px;">Licencia Vencida</span>
            {% elif empresa.licencia_por_vencer %}
                <span class="status-badge" style="background: #f39c12; font-size: 14px;">Licencia por Vencer</span>
            {% endif %}
        </h2>
        <p style="color: #7f8c8d;">{{ user.get_display_name }} ‚Ä¢ {% if user.role == 'evaluador' %}Evaluador Portuario{% else %}Supervisor{% endif %}</p>
    </div>

    <!-- Botones de Acci√≥n -->
    <div style="margin-bottom: 30px; display: flex; gap: 15px;">
        <a href="{% url 'empresas:listar_empresas' %}" class="btn btn-secondary">‚Ü©Ô∏è Volver a Lista</a>
        <a href="{% url 'empresas:editar_empresa' empresa.id %}" class="btn btn-primary">‚úèÔ∏è Editar Empresa</a>
    </div>

    <div class="row">
        <!-- Informaci√≥n Principal -->
        <div class="col-md-8">
            <!-- Informaci√≥n B√°sica -->
            <div class="form-container" style="margin-bottom: 30px;">
                <h4 style="color: #2c3e50; margin-bottom: 20px; border-bottom: 2px solid #e9ecef; padding-bottom: 10px;">
                    üìã Informaci√≥n B√°sica
                </h4>
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <strong>RNC:</strong><br>
                            <span style="font-family: monospace; color: #2c3e50;">{{ empresa.rnc }}</span>
                        </div>
                        <div class="mb-3">
                            <strong>Email:</strong><br>
                            {% if empresa.email %}
                                <a href="mailto:{{ empresa.email }}" style="color: #3498db;">{{ empresa.email }}</a>
                            {% else %}
                                <span style="color: #95a5a6;">No especificado</span>
                            {% endif %}
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <strong>Tel√©fono:</strong><br>
                            {% if empresa.telefono %}
                                <a href="tel:{{ empresa.telefono }}" style="color: #3498db;">{{ empresa.telefono }}</a>
                            {% else %}
                                <span style="color: #95a5a6;">No especificado</span>
                            {% endif %}
                        </div>
                        <div class="mb-3">
                            <strong>Estado:</strong><br>
                            {% if empresa.activa %}
                                <span style="color: #27ae60; font-weight: bold;">‚úÖ Activa</span>
                            {% else %}
                                <span style="color: #e74c3c; font-weight: bold;">‚ùå Inactiva</span>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% if empresa.direccion %}
                <div class="mb-3">
                    <strong>Direcci√≥n:</strong><br>
                    <span style="color: #2c3e50;">{{ empresa.direccion|linebreaksbr }}</span>
                </div>
                {% endif %}
            </div>

            <!-- Informaci√≥n de Licencia -->
            <div class="form-container" style="margin-bottom: 30px;">
                <h4 style="color: #2c3e50; margin-bottom: 20px; border-bottom: 2px solid #e9ecef; padding-bottom: 10px;">
                    üìú Informaci√≥n de Licencia
                </h4>
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <strong>N√∫mero de Licencia:</strong><br>
                            <span style="font-family: monospace; color: #2c3e50; background: #f8f9fa; padding: 5px 10px; border-radius: 4px;">
                                {{ empresa.numero_licencia }}
                            </span>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <strong>Fecha de Expiraci√≥n:</strong><br>
                            <span style="color: {% if empresa.licencia_vigente %}#27ae60{% else %}#e74c3c{% endif %}; font-weight: bold;">
                                {{ empresa.fecha_expiracion_licencia|date:"d/m/Y" }}
                            </span>
                            {% if empresa.licencia_vigente %}
                                {% if empresa.licencia_por_vencer %}
                                    <br><small style="color: #f39c12;">‚è∞ Vence en {{ empresa.dias_para_vencimiento }} d√≠as</small>
                                {% else %}
                                    <br><small style="color: #27ae60;">‚úÖ Vigente ({{ empresa.dias_para_vencimiento }} d√≠as restantes)</small>
                                {% endif %}
                            {% else %}
                                <br><small style="color: #e74c3c;">‚ö†Ô∏è Licencia vencida hace {{ empresa.dias_para_vencimiento|floatformat:"0" }} d√≠as</small>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Servicios Autorizados -->
            <div class="form-container">
                <h4 style="color: #2c3e50; margin-bottom: 20px; border-bottom: 2px solid #e9ecef; padding-bottom: 10px;">
                    üîß Servicios Autorizados
                </h4>
                {% if empresa.servicios_autorizados.exists %}
                    <div class="row">
                        {% for servicio in empresa.servicios_autorizados.all %}
                        <div class="col-md-6 mb-3">
                            <div style="border: 1px solid #ddd; padding: 15px; border-radius: 8px; background: #f9f9f9;">
                                <strong style="color: #2c3e50;">{{ servicio.nombre }}</strong>
                                {% if servicio.descripcion %}
                                    <br><small style="color: #666;">{{ servicio.descripcion|truncatewords:10 }}</small>
                                {% endif %}
                                <br><small style="color: {% if servicio.activo %}#27ae60{% else %}#e74c3c{% endif %};">
                                    {{ servicio.activo|yesno:"Servicio Activo,Servicio Inactivo" }}
                                </small>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div style="text-align: center; padding: 30px; background: #f8f9fa; border-radius: 8px;">
                        <div style="font-size: 48px; margin-bottom: 15px; color: #bdc3c7;">üîß</div>
                        <p style="color: #7f8c8d; margin: 0;">Esta empresa no tiene servicios autorizados</p>
                        <small style="color: #95a5a6;">Edite la empresa para agregar servicios</small>
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- Informaci√≥n Adicional -->
        <div class="col-md-4">
            <!-- Estad√≠sticas -->
            <div class="form-container" style="margin-bottom: 30px;">
                <h5 style="color: #2c3e50; margin-bottom: 15px;">üìä Resumen</h5>
                <div class="mb-3">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span style="font-size: 14px;">Servicios autorizados</span>
                        <strong>{{ empresa.servicios_autorizados.count }}</strong>
                    </div>
                </div>
                <div class="mb-3">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span style="font-size: 14px;">Registrada el</span>
                        <strong>{{ empresa.created_at|date:"d/m/Y" }}</strong>
                    </div>
                </div>
                <div class="mb-3">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span style="font-size: 14px;">√öltima actualizaci√≥n</span>
                        <strong>{{ empresa.updated_at|date:"d/m/Y H:i" }}</strong>
                    </div>
                </div>
            </div>

            <!-- Alertas -->
            {% if not empresa.licencia_vigente or empresa.licencia_por_vencer or not empresa.activa %}
            <div class="form-container" style="margin-bottom: 30px;">
                <h5 style="color: #e74c3c; margin-bottom: 15px;">‚ö†Ô∏è Alertas</h5>
                
                {% if not empresa.activa %}
                <div style="background: #f8d7da; border-left: 4px solid #e74c3c; padding: 12px; margin-bottom: 10px; border-radius: 4px;">
                    <div style="font-size: 12px; color: #721c24; font-weight: bold;">EMPRESA INACTIVA</div>
                    <div style="font-size: 12px; color: #721c24;">La empresa est√° marcada como inactiva</div>
                </div>
                {% endif %}

                {% if not empresa.licencia_vigente %}
                <div style="background: #f8d7da; border-left: 4px solid #e74c3c; padding: 12px; margin-bottom: 10px; border-radius: 4px;">
                    <div style="font-size: 12px; color: #721c24; font-weight: bold;">LICENCIA VENCIDA</div>
                    <div style="font-size: 12px; color: #721c24;">La licencia expir√≥ el {{ empresa.fecha_expiracion_licencia|date:"d/m/Y" }}</div>
                </div>
                {% elif empresa.licencia_por_vencer %}
                <div style="background: #fff3cd; border-left: 4px solid #f39c12; padding: 12px; margin-bottom: 10px; border-radius: 4px;">
                    <div style="font-size: 12px; color: #856404; font-weight: bold;">LICENCIA POR VENCER</div>
                    <div style="font-size: 12px; color: #856404;">La licencia vence en {{ empresa.dias_para_vencimiento }} d√≠as</div>
                </div>
                {% endif %}
            </div>
            {% endif %}

            <!-- Acciones R√°pidas -->
            <div class="form-container">
                <h5 style="color: #2c3e50; margin-bottom: 15px;">‚ö° Acciones R√°pidas</h5>
                <a href="{% url 'empresas:editar_empresa' empresa.id %}" class="btn btn-primary w-100 mb-2">
                    ‚úèÔ∏è Editar Informaci√≥n
                </a>
                <a href="{% url 'empresas:listar_servicios' %}" class="btn btn-outline-secondary w-100 mb-2">
                    üîß Gestionar Servicios
                </a>
                <a href="{% url 'empresas:listar_empresas' %}" class="btn btn-outline-primary w-100">
                    üìã Volver a Lista
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}