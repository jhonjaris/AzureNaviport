{% extends 'base.html' %}

{% block title %}{{ titulo }} | NaviPort RD{% endblock %}

{% block content %}
<!-- Navbar -->
{% include 'includes/navbar_evaluador.html' with active_page='config' %}

<div class="content-area">
    <!-- Breadcrumb -->
    <div style="margin-bottom: 20px;">
        <a href="{% url 'evaluacion:gestion_puertos' %}" style="color: #3498db; text-decoration: none;">‚Üê Volver a Gesti√≥n de Puertos</a>
    </div>

    <!-- Header -->
    <div class="page-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
        <div>
            <h2 style="color: #2c3e50; margin-bottom: 10px; display: flex; align-items: center; gap: 10px;">
                {% if puerto.activo %}‚úÖ{% else %}‚ùå{% endif %}
                {{ puerto.nombre }}
                <span style="background: #ecf0f1; color: #7f8c8d; padding: 4px 12px; border-radius: 6px; font-size: 14px; font-weight: normal;">
                    {{ puerto.codigo }}
                </span>
            </h2>
            {% if puerto.ubicacion %}
            <p style="color: #7f8c8d; margin-bottom: 5px;">üìç {{ puerto.ubicacion }}</p>
            {% endif %}
            {% if puerto.descripcion %}
            <p style="color: #5a6c7d; margin-bottom: 0;">{{ puerto.descripcion }}</p>
            {% endif %}
        </div>
        <div style="display: flex; gap: 10px;">
            <a href="{% url 'evaluacion:crear_lugar' puerto.pk %}" class="btn btn-primary">
                ‚ûï Nuevo Lugar
            </a>
            <a href="{% url 'evaluacion:editar_puerto' puerto.pk %}" class="btn" style="background: #f39c12; color: white;">
                ‚úèÔ∏è Editar Puerto
            </a>
        </div>
    </div>

    <!-- Estad√≠sticas del Puerto -->
    <div class="stats-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;">
        <div class="stat-card">
            <div class="stat-icon">üìç</div>
            <div class="stat-info">
                <div class="stat-number">{{ puerto_stats.total_lugares }}</div>
                <div class="stat-label">Total Lugares</div>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">‚úÖ</div>
            <div class="stat-info">
                <div class="stat-number">{{ puerto_stats.lugares_activos }}</div>
                <div class="stat-label">Lugares Activos</div>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">‚ùå</div>
            <div class="stat-info">
                <div class="stat-number">{{ puerto_stats.lugares_inactivos }}</div>
                <div class="stat-label">Lugares Inactivos</div>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">üìã</div>
            <div class="stat-info">
                <div class="stat-number">{{ puerto_stats.tipos_lugar.count }}</div>
                <div class="stat-label">Tipos Diferentes</div>
            </div>
        </div>
    </div>

    <!-- B√∫squeda de Lugares -->
    <div class="search-section" style="margin-bottom: 30px;">
        <form method="get" style="display: flex; gap: 15px; align-items: end;">
            <div style="flex: 1;">
                <label for="search" style="display: block; font-weight: bold; color: #2c3e50; margin-bottom: 5px;">
                    üîç Buscar Lugar
                </label>
                <input type="text" id="search" name="search" value="{{ search_query }}"
                       placeholder="Nombre, c√≥digo o tipo de lugar..."
                       style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
            </div>
            <button type="submit" class="btn btn-primary">Buscar</button>
            {% if search_query %}
            <a href="{% url 'evaluacion:detalle_puerto' puerto.pk %}" class="btn btn-secondary">Limpiar</a>
            {% endif %}
        </form>
    </div>

    <!-- Lista de Lugares -->
    <div class="lugares-container">
        {% if lugares %}
            <div class="lugares-grid" style="display: grid; gap: 20px;">
                {% for lugar in lugares %}
                <div class="lugar-card" style="background: white; border-radius: 8px; padding: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); border-left: 4px solid {% if lugar.activo %}#27ae60{% else %}#e74c3c{% endif %};">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
                        <div style="flex: 1;">
                            <h3 style="color: #2c3e50; margin-bottom: 5px; display: flex; align-items: center; gap: 8px;">
                                {{ lugar.get_tipo_display_icon }}
                                {{ lugar.nombre }}
                                <span style="background: #ecf0f1; color: #7f8c8d; padding: 2px 8px; border-radius: 4px; font-size: 12px; font-weight: normal;">
                                    {{ lugar.codigo }}
                                </span>
                                {% if not lugar.activo %}
                                <span style="background: #e74c3c; color: white; padding: 2px 8px; border-radius: 4px; font-size: 12px; font-weight: normal;">
                                    INACTIVO
                                </span>
                                {% endif %}
                            </h3>
                            <p style="color: #7f8c8d; margin-bottom: 8px;">
                                <strong>Tipo:</strong> {{ lugar.get_tipo_lugar_display }}
                            </p>
                            {% if lugar.descripcion %}
                            <p style="color: #5a6c7d; font-size: 14px; margin-bottom: 10px;">{{ lugar.descripcion|truncatewords:15 }}</p>
                            {% endif %}
                            {% if lugar.capacidad_maxima %}
                            <p style="color: #7f8c8d; font-size: 14px; margin-bottom: 5px;">
                                <strong>Capacidad:</strong> {{ lugar.capacidad_maxima }} unidades
                            </p>
                            {% endif %}
                        </div>
                        <div class="lugar-actions" style="display: flex; gap: 8px; margin-left: 15px;">
                            <a href="{% url 'evaluacion:editar_lugar' lugar.pk %}" class="btn btn-sm" style="background: #f39c12; color: white; padding: 5px 10px; font-size: 12px;">
                                ‚úèÔ∏è Editar
                            </a>
                            <button onclick="eliminarLugar({{ lugar.pk }}, '{{ lugar.nombre }}')" class="btn btn-sm" style="background: #e74c3c; color: white; padding: 5px 10px; font-size: 12px;">
                                üóëÔ∏è Eliminar
                            </button>
                        </div>
                    </div>

                    <!-- Informaci√≥n adicional -->
                    {% if lugar.observaciones %}
                    <div style="border-top: 1px solid #ecf0f1; padding-top: 10px; margin-top: 10px;">
                        <p style="color: #7f8c8d; font-size: 12px; margin: 0;">
                            <strong>Observaciones:</strong> {{ lugar.observaciones|truncatewords:20 }}
                        </p>
                    </div>
                    {% endif %}
                </div>
                {% endfor %}
            </div>

            <!-- Paginaci√≥n -->
            {% if lugares.has_other_pages %}
            <div class="pagination-container" style="margin-top: 30px; text-align: center;">
                <div class="pagination">
                    {% if lugares.has_previous %}
                        <a href="?page=1{% if search_query %}&search={{ search_query }}{% endif %}" class="page-link">¬´ Primera</a>
                        <a href="?page={{ lugares.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}" class="page-link">‚Äπ Anterior</a>
                    {% endif %}

                    <span class="page-info">
                        P√°gina {{ lugares.number }} de {{ lugares.paginator.num_pages }}
                    </span>

                    {% if lugares.has_next %}
                        <a href="?page={{ lugares.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}" class="page-link">Siguiente ‚Ä∫</a>
                        <a href="?page={{ lugares.paginator.num_pages }}{% if search_query %}&search={{ search_query }}{% endif %}" class="page-link">√öltima ¬ª</a>
                    {% endif %}
                </div>
            </div>
            {% endif %}
        {% else %}
            <div class="empty-state" style="text-align: center; padding: 60px 20px; background: white; border-radius: 8px;">
                <div style="font-size: 64px; margin-bottom: 20px;">üìç</div>
                <h3 style="color: #2c3e50; margin-bottom: 15px;">
                    {% if search_query %}
                        No se encontraron lugares
                    {% else %}
                        No hay lugares registrados
                    {% endif %}
                </h3>
                <p style="color: #7f8c8d; margin-bottom: 25px;">
                    {% if search_query %}
                        Intenta con otros t√©rminos de b√∫squeda
                    {% else %}
                        Este puerto a√∫n no tiene lugares espec√≠ficos configurados
                    {% endif %}
                </p>
                {% if not search_query %}
                <a href="{% url 'evaluacion:crear_lugar' puerto.pk %}" class="btn btn-primary">
                    ‚ûï Crear Primer Lugar
                </a>
                {% endif %}
            </div>
        {% endif %}
    </div>
</div>

<style>
.stat-card {
    background: white;
    border-radius: 8px;
    padding: 20px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    display: flex;
    align-items: center;
    gap: 15px;
}

.stat-icon {
    font-size: 32px;
    background: #f8f9fa;
    width: 60px;
    height: 60px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
}

.stat-number {
    font-size: 24px;
    font-weight: bold;
    color: #2c3e50;
}

.stat-label {
    color: #7f8c8d;
    font-size: 14px;
}

.btn-sm {
    border: none;
    border-radius: 4px;
    cursor: pointer;
    text-decoration: none;
    display: inline-block;
}

.pagination {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px;
}

.page-link {
    color: #3498db;
    text-decoration: none;
    padding: 8px 12px;
    border: 1px solid #ddd;
    border-radius: 4px;
}

.page-link:hover {
    background: #f8f9fa;
}

.page-info {
    padding: 8px 16px;
    color: #7f8c8d;
    font-weight: bold;
}

/* Responsive */
@media (max-width: 768px) {
    .lugar-card {
        margin: 0 15px;
    }

    .lugar-actions {
        flex-direction: column;
        margin-left: 0;
        margin-top: 10px;
    }

    .stats-grid {
        grid-template-columns: 1fr !important;
    }

    .page-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 15px;
    }
}
</style>

<script>
function eliminarLugar(lugarId, nombre) {
    if (confirm(`¬øEst√° seguro de que desea eliminar el lugar "${nombre}"?\n\nEsta acci√≥n no se puede deshacer.`)) {
        // Crear formulario para env√≠o POST
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = `/evaluacion/lugares/${lugarId}/eliminar/`;

        // Token CSRF
        const csrfToken = document.createElement('input');
        csrfToken.type = 'hidden';
        csrfToken.name = 'csrfmiddlewaretoken';
        csrfToken.value = '{{ csrf_token }}';
        form.appendChild(csrfToken);

        document.body.appendChild(form);
        form.submit();
    }
}
</script>

{% endblock %}